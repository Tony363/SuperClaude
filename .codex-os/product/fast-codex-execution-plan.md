# Fast Codex Execution Plan

## 0. Context
- Suggestion: extend `/sc:implement` with a streamlined `--fast-codex` flag that keeps the existing command executor but runs a simplified persona and validation path.
- Motivation: reduce friction for routine edits while preserving guardrails such as evidence capture, MCP activation, and telemetry hooks.
- Constraints: offline-first operation, limited MCP roster (PAL + sequential stubs), `requires_evidence` guardrail must remain intact, and docs/tests must stay aligned with `.codex-os` standards.
- Assumptions: command metadata remains YAML front matter, executor logic is centralized in `SuperClaude/Commands/executor.py`, and consensus policies live in `SuperClaude/Config/consensus_policies.yaml`.

## 1. Goals & Success Metrics
- **G1 – Faster happy-path implementation:** Average wall-clock for simple `/sc:implement` tasks with Codex persona drops by ≥30% (measure using `.superclaude_metrics/command_latency.json`).
- **G2 – Guardrails preserved:** `requires_evidence` success criteria still demand real diffs and test evidence; plan-only completions remain <5%.
- **G3 – Discoverability & documentation:** CLI help, README, and command docs clearly explain the new flag; user satisfaction captured via internal feedback surveys (target ≥4/5).
- **G4 – Observability:** Telemetry differentiates standard vs fast mode, enabling follow-up tuning.

## 2. Architecture Overview
1. **Command metadata extension**
   - Add optional `fast_codex` configuration in `SuperClaude/Commands/implement.md` front matter.
   - Declare flag semantics (`--fast-codex`) and update examples.
2. **Executor integration layer**
   - Update `CommandExecutor` parsing path to detect the flag and inject the Codex-focused persona set while skipping heavy planning personas.
   - Preserve logging, evidence capture, and MCP activation.
3. **Persona routing**
   - Map `fast_codex` persona to a prepared agent definition (likely `codex-implementer`) with reduced orchestration overhead.
   - Ensure fallback to full `/sc:implement` behavior when consensus or security checks trigger.
4. **Telemetry & guardrails**
   - Tag command context with execution mode for downstream metrics.
   - Run `requires_evidence` evaluation unchanged to guarantee real diffs.
5. **Documentation & developer ergonomics**
   - Update CLI help, command docs, and README usage patterns.
   - Add runbook section covering when to choose fast vs standard mode.

## 3. Workstreams & Deliverables

### WS-1 — Metadata & CLI Surface (Owner: CLI maintainers)
- Extend YAML front matter (`SuperClaude/Commands/implement.md`) with `flags` section describing `--fast-codex` (short aliases, default behavior, guardrail note).
- Add a concise “Quick Codex Flow” subsection in the Markdown body with usage examples.
- Update autogenerated CLI help if applicable (`SuperClaude/__main__.py` or script that renders command help).
- **Deliverables:** updated command doc, CLI help text, changelog entry.

### WS-2 — Executor & Persona Wiring (Owner: Framework core)
- Modify `CommandExecutor._prepare_context` and flag parsing to capture `fast_codex` intent and store it on `CommandContext`.
- Adjust `_load_agents` in `SuperClaude/Commands/executor.py` to select the Codex persona set when the flag is present (likely `['codex-implementer']`).
- Ensure `requires_evidence`, `consensus_policies`, and MCP activation still run; add guards that fall back to the standard persona set if consensus fails or the flag is disallowed.
- **Deliverables:** executor changes, persona mappings, unit tests proving mode selection and fallback.

### WS-3 — Telemetry & Guardrails (Owner: Monitoring)
- Emit execution-mode tag (e.g., `context.results['mode'] = 'fast-codex'`) so telemetry collectors differentiate runs.
- Update `.superclaude_metrics/command_latency.json` schema if needed to store the tag.
- Add regression tests ensuring `requires_evidence` still blocks plan-only completions in fast mode (`tests/integration/test_requires_evidence.py`).
- **Deliverables:** telemetry updates, regression tests, monitoring doc snippet.

### WS-4 — Documentation & Adoption (Owner: Docs/Developer Experience)
- README: add a “Fast Codex Mode” subsection under implementation workflows.
- Docs/User-Guide/command reference: include flag explanation, constraints, and guardrail reminders.
- Add FAQ entry addressing when to use fast mode vs full planning.
- **Deliverables:** README updates, user guide entry, FAQ addition, internal announcement draft.

## 4. Milestones & Timeline
- **Milestone 1 (Week of 2025-11-03):** WS-1 + WS-2 complete with local tests; submit PR with executor + metadata changes.
- **Milestone 2 (Week of 2025-11-10):** WS-3 telemetry integration and regression tests merged; monitoring dashboards refreshed.
- **Milestone 3 (Week of 2025-11-10):** WS-4 documentation updates published and changelog entry finalised.
- **Milestone 4 (Week of 2025-11-17):** Post-launch review using telemetry to validate metrics, capture feedback, and decide on further automation.

## 5. Dependencies & Risks
- **Consensus policies:** must confirm `SuperClaude/Config/consensus_policies.yaml` does not mandate multi-agent quorum for `/sc:implement` in ways that conflict with a single Codex persona; mitigation is conditional fallback to full mode.
- **Agent availability:** ensure a Codex-focused agent definition exists and adheres to offline requirements; create stub if missing.
- **Testing overhead:** integration tests may slow CI slightly; mitigate with targeted fixtures and `@pytest.mark.integration` for opt-in runs.
- **Documentation drift:** CLI help is partially auto-generated; coordinate with maintainers so updates propagate to distribution packages.
- **User misuse:** developers may overuse fast mode for complex tasks. Add guardrail messaging to caution against bypassing deep planning when risks are high.

## 6. Acceptance Checklist
- [ ] Executor correctly routes fast-mode runs and falls back on guardrail triggers.
- [ ] Telemetry dashboards show separate latency metrics for standard vs fast mode.
- [ ] `/sc:implement --fast-codex` documented in README, command doc, and CLI help.
- [ ] Regression tests cover requires-evidence enforcement in both modes.
- [ ] Changelog entry and internal announcement drafted.

## 7. Follow-Up Actions
- Log decision in `.codex-os/product/decisions.md` once implemented (reference this plan).
- Evaluate whether other commands (`/sc:build`, `/sc:test`) benefit from similar fast paths.
- After telemetry review, consider auto-detecting when fast mode is safe based on task size and risk profile.

